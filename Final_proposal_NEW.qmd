---
title: "Car Crashes in New York City"
author: "Sawyer Cremer, Sophie Chikhladze, Adarsh Gadepalli, Rahul Prakash"
tbl-cap-location: top
format:
  pdf:
    toc: true
    toc-depth: 3
---

{{< pagebreak >}}

# Introduction

1.3 million people die each year as a result of road traffic crashes, and between 20 and 50 million people every year suffer non-fatal injuries resulting from car accidents. Other than the millions of lives lost, the U.S. Department of Transportation's most recent estimate of the annual economic cost of crashes is \$340 billion. This is an issue affecting virtually every country in the world, including the United States. In New York City, New York, the New York Police Department is required to be fill out a report for every collision where someone is injured or killed, or where there is at least \$1000 worth of damage.

# Primary Dataset

The Motor Vehicle Collisions dataset contains information about car crashes in NYC from the years 2016-2023. It contains information from all police reported motor vehicle collisions in NYC. We accessed the dataset from data.gov, provided by the City of New York. Each entry represents a car crash that occured in New York City. The dataset contains 28 columns that describe a variety of data, including time of accident, accident severity(deaths/injuries), pinpointed locations (neighborhoods/streets), causes for the accident, and vehicle type. Using this data, we hope to analyze and identify chronological and geographical patterns in New York City to pinpoint high-risk environments and circumstances. We are assuming that the data is continuous in terms of time, and that the specific timestamps and event details are accurate. Every plot in this document employs the primary data set, unless specified otherwise.

```{r Setup, echo = FALSE}
# KEEP THIS!
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 8, fig.height = 5)

# Sophie: 
knitr::opts_knit$set(root.dir = "/Users/sophiochikhladze/Desktop/Stat_405/Stat405_Data")

# Sawyer: 
#knitr::opts_knit$set(root.dir = "/Users/danielcufino/Desktop/STAT 405")

# Adarsh:
#knitr::opts_knit$set(root.dir = "")

# Rahul:
#knitr::opts_knit$set(root.dir = "")
```

```{r Load Dataset}
options(stringsAsFactors = FALSE)
nyc_crashes <- read.csv("Motor_Vehicle_Collisions_-_Crashes.csv")
```

{{< pagebreak >}}

# Plots

## Number of Car Crashes over Time

First, we decided to plot a time series of the number of car crashes each day starting from 2012 up until 2023. Each point represents the total number of crashes that occurred on each day, plotted chronologically.

```{r Crashes Time Series,fig.cap="Number of Car Crashes over Time"}
nyc_crashes$CRASH.DATE <- as.Date(nyc_crashes$CRASH.DATE,format = "%m/%d/%Y")
dates <- factor(nyc_crashes$CRASH.DATE[!is.na(nyc_crashes$CRASH.DATE)])
plot(as.Date(levels(dates)), as.numeric(table(dates)), type = "l", xlab = "Date", ylab = "Number of Car Crashes", main = "Number of Car Crashes in NYC over Time", yaxt = "n")
axis(2, las = 2)
#mtext(text = "Data: Motor Vehicle Collisions in New York City, New York", side = 1, line = 4, adj = 1)
```

Looking at the number of crashes over time, from 2012 to 2023, we can see that the number of crashes remained fairly consistent from 2012 to the beginning of 2020, with certain exceptions like big spikes or drops. Until 2020, there is no year with an exceptionally low or high number of crashes. However, we see a clear change in the number of crashes in the beginning of 2020, which can be interpreted as the effects of COVID-19 as that is roughly the date it started. Less people had to go to work, school became virtual, and therefore less people were driving, leading to a lowered number of car crashes per day. We could also further study the exact dates of this drop versus when the lockdown started.

{{< pagebreak >}}

## Number of Car Crashes and Deaths per Borough

For this plot, we grouped the data by 5 boroughs of New York City: Bronx, Brooklyn, Manhattan, Queens, and Staten Island. First, we calculated the total number of car crashes in each borough, and plotted it in tens of thousands since there was a large amount. Then, we wanted to see if the number of casualties in each borough was proportional to the number of car crashes. Therefore, we calculated the total number of deaths from car accidents per borough and plotted that beside the number of car crashes.

```{r Number of Car Crashes and Deaths per Borough, fig.cap="Number of Car Crashes and Deaths per Borough"}
dead_boroughs <- factor(nyc_crashes$BOROUGH[nyc_crashes$NUMBER.OF.PERSONS.KILLED > 0 & nyc_crashes$BOROUGH!=""])
boroughs <- factor(nyc_crashes$BOROUGH[nyc_crashes$BOROUGH!=""])
num_crashes <- as.numeric(table(boroughs)) / 10000
num_deaths <- as.numeric(table(dead_boroughs))
y_ticks <- seq(0, 56, by = 8)
par(mgp = c(1.8, 0.2, 0),
    tck = 0.02)
layout(matrix(c(1, 2), nrow = 1, byrow = TRUE))
barplot(num_crashes,
        names.arg = c("Bronx", "Brooklyn", "Manhattan", "Queens", "Staten Island"),
        col = c("lightblue"), las = 2, yaxt = "n", yaxs = "i", ylim = c(0, 46),
        ylab = "Number of Crashes detected",
        main = strwrap("# of Car Crashes per Borough, in tens of thousands", 25), axes = TRUE)
axis(2, las = 2, at = y_ticks, labels = y_ticks)
barplot(num_deaths,
        names.arg = c("Bronx", "Brooklyn", "Manhattan", "Queens", "Staten Island"),
        col = c("royalblue"), las = 2, ylab = "Number of Deaths", ylim = c(0,600),
        main = strwrap("# of Deaths from Car Crashes per Borough", 25))
#mtext(text = "Data: Motor Vehicle Collisions in New York City, New York", side = 1, line = 6, adj = 1)
```

From the left plot, we can see that Brooklyn has the highest amount of crashes, followed by Queens and Manhattan. Staten Island has the lowest number of crashes recorded, by a significant amount. Despite the fact that Staten Island has the highest number of cars per household, it is sensible that the rest of the boroughs have more car accidents, since there is more general traffic there. Furthermore, if we compare the number of crashes per borough to the number of casualties per borough, We can see that the proportions of deaths are similar to the number of accidents, except for Manhattan, which is slightly lower.

{{< pagebreak >}}

## The Density of Total Number of Casualties

This is a density plot visualizing total casualties for all accidents in our dataset, where a casualty is either a person injured or a person killed. The plot visualizes the probability density function (pdf) of total casualties of car crashes in NYC. It shows the distribution of car crash casualties in NYC and how likely each amount is.

```{r Density of Total Number of Casualties, fig.cap="The Density of Total Number of Casualties"}
nyc_crashes$TOTAL.CASUALTIES <- nyc_crashes$NUMBER.OF.PERSONS.INJURED + nyc_crashes$NUMBER.OF.PERSONS.KILLED
threshold <- quantile(nyc_crashes$TOTAL.CASUALTIES, 0.9995, na.rm=TRUE)
filtered_data <- nyc_crashes[nyc_crashes$TOTAL.CASUALTIES <= threshold,]
density_estimates <- density(filtered_data$TOTAL.CASUALTIES, na.rm=TRUE)

plot(density_estimates,
     main = "Density of Total Casualties of Car Crashes in NYC",
     xlab = "Number of Casualties",
     ylab = "Density",
     col = "blue",
     lwd = 2)
#mtext(text = "Data: Motor Vehicle Collisions in New York City, New York", side = 1, line = 4, adj = 1)
```

This plot suggests that based on our data, car crashes in NYC are most likely to result in no casualties, evidenced by the density for 0 casualties being by far the highest amount. As the number of casualties increases, a large drop is seen. However, there is likelihood for a car accident to result in 1 or 2 casualties, but past that the likelihood drops to virtually 0. This shows that more severe crashes are much less likely in NYC.

{{< pagebreak >}}

## Average Accidents per Day per Season

Next, we asked ourselves - is an accident more or less likely to occur during a specific season? For this, we turned each date into a season and calculated the number of car crashes per day for each season. The, we plotted 4 boxplots to represent each season portraying the number of car crashes per day.

```{r Average Accidents per Day per Season, fig.cap="Average Accidents per Day per Season"}
conv_season <- function(date) {
  m <- as.numeric(format(date, "%m"))
  if(m == 12 || m == 1 || m == 2){
    return("Winter")
  }else if(m == 3 || m == 4 || m == 5){
    return("Spring")
  }else if(m == 6 || m == 7 || m == 8){
    return("Summer")
  }else{
    return("Fall")
  }
}
daily_counts <- data.frame(Date = unique(nyc_crashes$CRASH.DATE))
daily_counts$Season <- sapply(daily_counts$Date, conv_season)
daily_counts$Count <- sapply(daily_counts$Date, function(date) {
  sum(nyc_crashes$CRASH.DATE == date)
})
boxplot(Count ~ Season, data = daily_counts,
        xlab = "Season", ylab = "Number of Accidents per Day",
        main = "Average Daily Accidents per Season",
        yaxt = "n", yaxs = "i", ylim = c(0, 1300),
        col = c("chocolate2", "mistyrose", "khaki1", "slategray1"))
axis(2, las = 2, at = seq(from = 0, to = 1200, by = 300), labels =  seq(from = 0, to = 1200, by = 300))
#mtext(text = "Data: Motor Vehicle Collisions in New York City, New York", side = 1, line = 4, adj = 1)

```

As we can see, there is a relatively similar amount of car crashes across all the seasons, suggesting that the season does not significantly affect the likelihood of crashes occurring. One interesting point is that there is a much larger variance and spread of car crashes per day in the fall while there is a significantly smaller variance of car crashes per day in the summer. There is also an outlier in the Winter, where over 1200 crashes happened on one day. However, this is just an outlier since the median number of crashes in Winter is slightly lower than the median number of crashes in the Summer and Fall.

{{< pagebreak >}}

## Number of Cars Involved in a Car Crash Histogram

We decided to find out how many cars were involved in each accident. While there wasn't a column for the number of cars involved, there were 5 columns for vehicle type, so we counted each nonempty entry as a car involved.

```{r Number of Cars Involved in a Car Crash Histogram, fig.cap="Number of Cars Involved in a Car Crash Histogram"}
num_cars <- data.frame(Date = (nyc_crashes$CRASH.DATE))
num_cars$cars = (nyc_crashes$VEHICLE.TYPE.CODE.1!= "") + (nyc_crashes$VEHICLE.TYPE.CODE.2!= "") + (nyc_crashes$VEHICLE.TYPE.CODE.3!= "") + (nyc_crashes$VEHICLE.TYPE.CODE.4!= "") + (nyc_crashes$VEHICLE.TYPE.CODE.5!= "")
hist(num_cars$cars, col = c('lightgreen', 'limegreen', 'darkolivegreen4','green4', 'darkgreen', 'black'), main = strwrap("The number of Cars Involved in each Accident and its Frequency", 30), xlab = 'The Number of Cars involved', ylim = c(0, 1500000), yaxt = 'n', ylab = "")
axis(2, las = 2)
#mtext(text = "Data: Motor Vehicle Collisions in New York City, New York", side = 1, line = 4, adj = 1)
```

As the histogram shows, the highest frequency of cars involved in a given car crash peak at 2 cars, with lower frequencies otherwise. The number of crashes at 3+ cars are relatively low, implying the rarity of largescale accidents and the commonality of lower scale, regular accidents involving 2 cars. There is a little under 500 000 accidents involving just one car, which can mean the driver was inattentive and crashed into something or crashed into a pedestrian/cyclist.

{{< pagebreak >}}

## 5 Most Common Reasons for Car Crashes

We decided to find the 5 most common specified reasons for car crashes in New York. While a majority of the causes was unspecified or other, we decided not to include those in our chart.

```{r 5 Most Common Reasons for Car Crashes, fig.cap="5 Most Common Reasons for Car Crashes"}
x <- table(nyc_crashes$CONTRIBUTING.FACTOR.VEHICLE.1)
#x[order(-x)]

count_distraction <- sum(nyc_crashes$CONTRIBUTING.FACTOR.VEHICLE.1 == "Driver Inattention/Distraction")
count_yield <- sum(nyc_crashes$CONTRIBUTING.FACTOR.VEHICLE.1 == "Failure to Yield Right-of-Way")
count_following <- sum(nyc_crashes$CONTRIBUTING.FACTOR.VEHICLE.1 == "Following Too Closely")
count_backing <- sum(nyc_crashes$CONTRIBUTING.FACTOR.VEHICLE.1 == "Backing Unsafely")
count_other <- sum(nyc_crashes$CONTRIBUTING.FACTOR.VEHICLE.1 == "Other Vehicular")
colors <- c("coral", "lightblue", "lightgreen", "pink", "orange")
perc <- (count_distraction + count_yield + count_following + count_backing + count_other) / length(nyc_crashes$CONTRIBUTING.FACTOR.VEHICLE.1[!is.na(nyc_crashes$CONTRIBUTING.FACTOR.VEHICLE.1)]) * 100
data <- c(count_distraction, count_yield, count_following, count_backing, count_other)
categories <- c("Driver Inattention", "Failure to Yield Right of Way", "Following Too Closely", "Backing Unsafely", "Other Vehicular")
pie(data, labels = categories, col = colors , main = strwrap(paste0("Top 5 Specified Reasons for Car Crashes (", round(perc, 2), "% of All Crashes)"), 35))
#mtext(text = "Data: Motor Vehicle Collisions in New York City, New York", side = 1, line = 4, adj = 1)
```

This plot displays the distribution of the most common reasons for car crashes in New York. As we can see, a high portion of crashes are due to driver inattention (possibly due to using their phone while driving, or generally not paying attention), while the other reasons are similarly represented at a much smaller amount. These reasons include Failure to Yield Right of Way, Following Too Closely, and Backing Unsafely.

{{< pagebreak >}}

# Regression

This is a linear regression over a plot of car crashes vs precipitation in New York City, New York. Displayed in the table below are the intercept and the coefficient for precipitation.

```{r Regression}
#| tbl-cap: "Regression over Total Number of Car Crashes vs Precipitation per Day in NYC"
library(flextable)
weatherdata<-read.csv("New York City,USA 2020-09-01 to 2022-12-31.csv")

merged_data3 <- merge(daily_counts, weatherdata, by.x="Date", by.y="datetime")
colnames(merged_data3)[13] = "Precipitation"

model <- lm(Count ~ Precipitation, data = merged_data3)
as_flextable(model,  col_keys = c("Intercept", "Precipitation \n Coefficient"))
```

The plot depicting the relationship, as well as further analysis, is on the next page.

{{< pagebreak >}}

```{r Regression plot, fig.cap="Total Number of Car Crashes vs Precipitation per Day in NYC", fig.width = 6, fig.height = 4}
plot(merged_data3$Precipitation, merged_data3$Count,
     xlab="Precipitation", ylab="Number of Crashes",
     main="Total Number of Car Crashes vs Precipitation per Day in NYC", yaxt = 'n')
axis(2, las = 2)
abline(model, col="red")
#mtext(text = "Data: Motor Vehicle Collisions in New York City, New York and Weather in New York City", side = 1, line = 4, adj = 1)
```

The summary of the regression indicates that as there is a one unit increase in precipitation, the average number of car crashes increases by 0.04545. The intercept shows that the estimated average number of car crashes on a day with no precipitation in NYC is 294.69. The precipitation coefficient is not statistically significant because of its high p-value of 0.876, and the t-value of 0.156 further reinforces the lack of statistical significance in the coefficient.

{{< pagebreak >}}

# Plots using ggplot

## Number of Car Crashes Over/Under average per Day of Week

The plot below demonstrates a heat map of the number of crashes over/under average per day of week per borough. The numbers represent daily averages for each borough subtracted from the number of crashes per day. This is to demonstrate how the number of crashes varies per day of week. Green represents below average number of crashes, yellow represents an average number of crashes, and orange and red represent an above average number of crashes.

```{r Car Crashes Over/Under average per Day of Week, fig.cap="Number of Car Crashes Over/Under average per Day of Week"}
# Create the faceted heatmap with sorted weekdays
library(ggplot2)
library(viridis)

nyc_crashes$WEEKDAY <- weekdays(nyc_crashes$CRASH.DATE)
borough_weekday_subset <- nyc_crashes[(nyc_crashes$BOROUGH!=""),]

borough_crash_counts <- as.data.frame(table(borough_weekday_subset$BOROUGH, borough_weekday_subset$WEEKDAY))

colnames(borough_crash_counts) <- c("Borough", "Weekday", "Count")
weekday_order <- c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" )

avg_borough <- data.frame(Borough = unique(borough_crash_counts$Borough))
avg_borough$Average <- sapply(avg_borough$Borough, function(borough){
  mean(borough_crash_counts$Count[borough_crash_counts$Borough == borough])
})

borough_crash_counts$Count_avg <- apply(borough_crash_counts, MARGIN = 1, FUN = function(row){
  return(as.numeric(row[3]) - as.numeric(avg_borough$Average[avg_borough$Borough == row[1]]))
})

ggplot(borough_crash_counts, aes(x = Borough, y = factor(Weekday, levels = rev(weekday_order)), fill = Count_avg)) +
  geom_tile(color = "white", size = 0.1) +
  coord_equal() +
  labs(
    x = "Borough",
    y = "Day of Week",
    title = "Number of Crashes Over/Under Average\nper Day of Week in Each Borough",
#    caption = "Data: Motor Vehicle Collisions in New York City, New York",
    fill = "Number of\n Accidents"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1) 
  ) +
  scale_fill_gradient2(low = "green3", mid = "gold", high = "red") +
  theme(plot.title = element_text(hjust = 0.5)) 

```

The heat map shows that in all boroughs, the highest number of crashes occurs on Fridays. The lowest in all boroughs occurs on Sundays. In general, a higher number of crashes happen on weekdays, which makes sense since a lot of New York City residents who work drive to and from work on weekdays. The plot also demonstrates variation in car crashes per borough. Staten Island has the least variation, but also has the least number of crashes as we saw in Figure 2. Manhattan has the highest variation, followed by Brooklyn.

{{< pagebreak >}}

## Number of Car Crashes per ZIP code

The plot below demonstrates the number of car crashes per ZIP code in New York City, New York. The plot displays more and less accident-prone zones. As demonstrated in the legend, light yellow is the lower number of crashes, while dark red is the higher number of crashes. The ZIP codes that are gray had no data - indicating that either no car crashes happened in that zone, or none that were recorded. The x axis in the plot represents longitude and the y axis represents latitude.

```{r Car Crashes per ZIP code, fig.cap="Number of Car Crashes per ZIP code"}
library(tidyverse)
library(sf)

nyc_crashes$ZIP.CODE <- as.character(nyc_crashes$ZIP.CODE)
nyc_crashes$ZIP.CODE <- sub("\\.0$", "", nyc_crashes$ZIP.CODE)
zip_counts <- nyc_crashes %>%
group_by(ZIP.CODE) %>%
summarize(count = n())
nyc_zip_boundaries <- st_read("zipcodes.geojson", quiet = TRUE)
merged_zip_data <- left_join(nyc_zip_boundaries, zip_counts, by = c("ZIPCODE" = "ZIP.CODE"))
ggplot(merged_zip_data) +
  geom_sf(aes(fill = count)) +
  scale_fill_gradient(low = "lightyellow", high = "darkred", 
                      name = "Count of Car Crashes") +
  ggtitle("Car Crashes by NYC ZIP Code") +
  labs(x = "Longitude", y = "Latitude", 
 #      caption = "Data: Motor Vehicle Collisions in New York City, New York"
 ) +
  theme_minimal()
```

From the plot, it is visible that some of these darker regions include areas where major bridges lead into and out of Manhattan to Queens and Brooklyn, which might be a factor for why there is a high volume of crashes in these areas. The lighter shaded ZIP codes on the map signify regions with fewer crashes. Generally, there are less crashes in the borough of Staten Island based on this graphic, which might be due to a lower traffic and population. The gray block in Manhattan is central park, so it is logical that no crashes occurred in that ZIP code.

{{< pagebreak >}}

## Number of Car Crashes by Hour of Day

The polar bar chart shows the number of car crashes in New York City by hour of the day. Each bar segment corresponds to an hour, labeled from 12:00AM to 11:00PM. A longer bar indicates a higher number of crashes occurred during that hour.

```{r Car Crashes by Hour of Day, fig.cap="Number of Car Crashes by Hour of Day"}
library(dplyr)
library(ggplot2)
library(lubridate)

nyc_crashes$Hour <- hour(hm(nyc_crashes$CRASH.TIME))

hourly_crashes <- nyc_crashes %>%
  group_by(Hour) %>%
  summarise(Count = n()) %>%
  arrange(Hour)

ggplot(hourly_crashes, aes(x = factor(Hour), y = Count)) +
  geom_bar(stat = "identity", fill = "goldenrod", show.legend = FALSE) +
  coord_polar(start = 0) +
  labs(
    title = "Number of Car Crashes by Hour of Day",
#    caption = "Data: Motor Vehicle Collisions in New York City, New York",
    x = "",
    y = ""
  ) +
  theme_minimal() +
  scale_x_discrete(labels = paste0(c(12, 1:11, 12, 1:11), ":00", c(rep(" AM", 12), rep(" PM", 12) ))) + 
  theme(axis.text.y = element_blank(), 
        axis.ticks.y = element_blank(),
        axis.text.x = element_text(size = 7),
        plot.title = element_text(hjust = 0.5)) 
```

There is a substantial increase in the amount of crashes during the late afternoon hours known as "rush hour", peaking around 16:00 (4 PM). This is because there is increased traffic as people commute back from work. The number of crashes decreases significantly in the early morning hours, showing that there are fewer incidents when there are fewer vehicles on the road.

{{< pagebreak >}}

## Number of Car Crashes by Type of Vehicle per Year

Below is a histogram of accidents by year, with each bar filled based on the top 3 types of vehicles involved in those accidents. These three categories are passenger vehicle, depicted in green, station wagon or sport utility vehicle, depicted in turquoise, and finally taxi, depicted in magenta. The x axis represents the year and y axis represents the number of accidents that occurred.

```{r Crashes by Vehicle Type per Year, fig.cap="Number of Car Crashes by Type of Vehicle per Year"}
nyc_crashes$Year <- format(nyc_crashes$CRASH.DATE, "%Y")
old_values <- c("4 dr sedan", "2 dr sedan", "SEDAN", "sedan", "PASSENGER VEHICLE", "Sedan")
new_value <- "Passenger Vehicle"
old_values1 <- c("SPORT UTILITY / STATION WAGON")
new_value1 <- "Station Wagon/Sport Utility Vehicle"
old_values2 <- c("TAXI")
new_value2 <- "Taxi"
old_values3 <- c("Passenger Vehicle", "Station Wagon/Sport Utility Vehicle", "Taxi")
new_values3 <- "Other"



# Use conditional indexing to change the values
nyc_crashes$VEHICLE.TYPE.CODE.1[nyc_crashes$VEHICLE.TYPE.CODE.1 %in% old_values] <- new_value
nyc_crashes$VEHICLE.TYPE.CODE.1[nyc_crashes$VEHICLE.TYPE.CODE.1 %in% old_values1] <- new_value1
nyc_crashes$VEHICLE.TYPE.CODE.1[nyc_crashes$VEHICLE.TYPE.CODE.1 %in% old_values2] <- new_value2
nyc_crashes$VEHICLE.TYPE.CODE.1[nyc_crashes$VEHICLE.TYPE.CODE.1 != old_values3] <- new_values3

top_10_factors <- head(sort(table(nyc_crashes$VEHICLE.TYPE.CODE.1), decreasing = TRUE), 10)

type_of_car_accidents <- data.frame(table(nyc_crashes$Year, nyc_crashes$VEHICLE.TYPE.CODE.1))

# Create the bar plot
ggplot(type_of_car_accidents, aes(x = Var1, y = Freq, fill = Var2)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(
    title = "Number of Car Accidents by Year and Type of Car",
    subtitle = "3 Most Common Car Types",
#    caption = "Data: Motor Vehicle Collisions in New York City, New York",
    x = "Year",
    y = "Number of Accidents",
    fill = "Type of Car"
  ) +
  theme_minimal() + 
    theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

```

As we can see, there is a relatively large portion of each bar designated as 'Other', displaying the widespread variety of vehicles in accidents. Besides that, the next most common vehicle is a passenger vehicle. After that, the most prevalent was a station wagon or a sport utility vehicle. The last, much smaller category included in the plot is Taxi. This order remains the same throughout all years. Furthermore, we see a sharp decrease in the number of accidents in 2020, most likely due to the onset of COVID, but what's interesting to note is that accident numbers have not returned to what they once were post COVID. We can also see that the relative proportion of accidents with passenger vehicles, station wagons, and taxi's remain similar throughout the years. {{< pagebreak >}}

## Density of Casualties by Contributing Factor

This is a density plot visualizing total casualties for all accidents by contributing factor in our data set, where a casualty is either a person injured or a person killed. The plot visualizes the probability density function (pdf) of total casualties of car crashes in NYC. It shows the distribution of car crash casualties in NYC for 4 most common contributing factors. This plot gives us insight into how different contributing factors can influence the number of casualties.

```{r Density of Casualties by Contributing Factor, fig.cap="Number of Car Crashes by Type of Vehicle per Year"}
nyc_crashes_filtered <- nyc_crashes[nyc_crashes$CONTRIBUTING.FACTOR.VEHICLE.1 != "Unspecified", ]
top_5_factors <- head(sort(table(nyc_crashes_filtered$CONTRIBUTING.FACTOR.VEHICLE.1), decreasing = TRUE), 4)
subset_data <- nyc_crashes_filtered[nyc_crashes_filtered$CONTRIBUTING.FACTOR.VEHICLE.1 %in% names(top_5_factors), ]
desired_order <- rev(names(top_5_factors))
subset_data$CONTRIBUTING.FACTOR.VEHICLE.1 <- factor(subset_data$CONTRIBUTING.FACTOR.VEHICLE.1, levels = desired_order)
ggplot(subset_data, aes(x = NUMBER.OF.PERSONS.KILLED + NUMBER.OF.PERSONS.INJURED, colour = CONTRIBUTING.FACTOR.VEHICLE.1)) +
  geom_density(fill = NA, size=0.6, adjust = 3) +  
  labs(title = "Density Plot of Number of Casualties",
       subtitle = "Top 4 Contributing Factors",
#       caption = "Data: Motor Vehicle Collisions in New York City, New York",
       fill = "Contributing Factor",
       x = "Number of Casualties",
       y = "Density") +
  scale_x_continuous(
    labels = c( "0", "1", "2", "3", "4", "5")  
  ) +
  theme_minimal() +  xlim(c(-0.5,5.5))+ ylim(c(0, 5)) +
 scale_colour_manual(values = c("purple3", "red2", "royalblue", "green3")) +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5), 
        legend.position = c(0.95, 0.95), legend.justification = c(1, 1)) +
  guides(colour = guide_legend(title = "Contributing Factor"))


```

The plot shows that there is a large difference between low casualty (0 or 1) accidents caused by Failure to Yield Right of Way as compared to the rest of the contributing factors. However, for higher casualty incidents (greater than 2), this difference largely decreases and there is a relatively similar amount of high casualty accidents caused by Failure to Yield Right of Way as to caused by Driver Inattention and Distraction. This suggests that there is a much higher likelihood of a low casualty accident being caused by Failure to Yield Right of Way than a high casualty accident. Furthermore, accidents with 1 or more casualty are more likely to be caused by failure to yield, followed by driver inattention. {{< pagebreak >}}

## Number of Crashes by Weather Conditions

The Box-Dot plot below displays the number of crashes that occur for a given day for the various categories of weather conditions. The weather conditions are listed on the x axis, while the number of car accidents is on the y axis. Each blue dot represents a day - its x coordinate is the weather that day, and the y coordinate is the number of accidents that occurred that day. The boxes show the first and third quartiles, as well as the median number of car crashes for each weather. This plot, in addition to the primary data set, utilizes the secondary data set, Weather in New York City, New York from 2020-09-01 to 2022-12-31 \[2\].

```{r Number of Crashes by Weather Conditions, fig.cap="Number of Crashes by Weather Conditions"}
merged_data3$icon[merged_data3$icon == "clear-day"] <- "clear"
merged_data3$icon[merged_data3$icon == "partly-cloudy-day"] <- "partly cloudy"

ggplot(merged_data3, aes(icon, Count)) +
geom_boxplot( width = 0.97, fill = "transparent") +  
  geom_dotplot(binaxis = 'y',
               stackdir = 'center',
               dotsize = 0.22,
              stackratio = 1.4,  
               fill = "lightblue2", color = "blue3", alpha = 0.7) +
  theme(axis.text.x = element_text(angle = 65, vjust = 0.6)) +
  labs(title = "Number of Crashes vs Weather Conditions",
       subtitle = "From 09/01/2020 to 12/31/2022",
       x = "Weather Conditions",
       #caption = "Data: Motor Vehicle Collisions in New York City, New York and Weather in New York City",
       y = "Crashes per Day") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5), 
        axis.text.x = element_text(hjust = 0.5))


```

The plot shows that from 09/01/2020 to 12/31/2022, there was a majority of rainy days, followed by clear days, and partly cloudy days. This can be concluded by the number of blue dots on each section of the x axis. The median number of car accidents for a clear day is slightly higher than the number of car accidents on the rainy days. However, the rain box has two outliers, where the highest number of car accidents happened out of all days. What is quite surprising to note is that the median number of accidents on snowy days is lower than the median number of accidents on clear days, which may be the case because less people are out on the road during snowy weather. {{< pagebreak >}}

# Resources

1.  Primary Data Set: [Motor Vehicle Collisions in New York City, New York](https://catalog.data.gov/dataset/motor-vehicle-collisions-crashes/resource/b5a431d2-4832-43a6-9334-86b62bdb033f)

2.  Secondary Data Set: [Weather in New York City, New York from 2020-09-01 to 2022-12-31](https://www.visualcrossing.com/weather/weather-data-services/New%20York%20City,USA/metric/2019-01-01/2022-12-31)

3.  [Road Traffic Injuries](https://www.who.int/news-room/fact-sheets/detail/road-traffic-injuries) - World Health Organization
